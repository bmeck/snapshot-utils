<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Terms</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/bmeck/snapshot-utils" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual" data-toc-name="overview">
    <h1 class="manual-toc-title"><a href="manual/overview.html" data-ice="title">Overview</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/overview.html#snapshot-utils" data-ice="link">snapshot-utils</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/overview.html#docs" data-ice="link">docs</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/overview.html#installation" data-ice="link">installation</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="tutorial">
    <h1 class="manual-toc-title"><a href="manual/tutorial.html" data-ice="title">Tutorial</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/tutorial.html#get-all-nodes" data-ice="link">Get All Nodes</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/tutorial.html#get-all-variables" data-ice="link">Get All Variables</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="reference">
    <h1 class="manual-toc-title"><a href="identifiers.html" data-ice="title">Reference</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#class" data-ice="link">Class</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#function" data-ice="link">Function</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="identifiers.html#typedef" data-ice="link">Typedef</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="terms">
    <h1 class="manual-toc-title"><a href="manual/terms.html" data-ice="title">Terms</a></h1>
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/terms.html#snapshot" data-ice="link">Snapshot</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#root" data-ice="link">Root</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/terms.html#node" data-ice="link">Node</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#node-type" data-ice="link">node.type</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#node-name" data-ice="link">node.name</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#retainers" data-ice="link">Retainers</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#dominator" data-ice="link">Dominator</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/terms.html#weak-reference-gotcha" data-ice="link">Weak Reference Gotcha</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#distance" data-ice="link">Distance</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#self-size" data-ice="link">Self Size</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#retained-size" data-ice="link">Retained Size</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/terms.html#the-sharing-gotcha" data-ice="link">The Sharing Gotcha</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#closed-size" data-ice="link">Closed Size</a></li>
<li data-ice="manualNav" class="indent-h3"><span class="manual-dot"></span><a href="manual/terms.html#the-global-gotcha" data-ice="link">The Global Gotcha</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#retained-size-vs-closed-size" data-ice="link">Retained Size vs. Closed Size</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/terms.html#edge" data-ice="link">Edge</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#edge-type" data-ice="link">edge.type</a></li>
<li data-ice="manualNav" class="indent-h2"><span class="manual-dot"></span><a href="manual/terms.html#edge-name" data-ice="link">edge.name</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/terms.html#security" data-ice="link">Security</a></li>
<li data-ice="manualNav" class="indent-h1"><span class="manual-dot"></span><a href="manual/terms.html#processing-considerations" data-ice="link">Processing Considerations</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-breadcrumb-list">
    <a href="./manual/./index.html">Manual</a>
    <span>&#xBB;</span>
    <span data-ice="title">Terms</span>
  </div>
  <div data-ice="content"><p>This page consists mostly of definitions (es-doc won&apos;t let me name manual pages anything I want).</p>
<h1 id="snapshot">Snapshot</h1>
<p>synonyms: <a href="#Snapshot">Heapsnapshot</a>, <a href="#Snapshot">Heapdump</a></p>
<p>This is the representation of all <em>non-primitive</em> objects on that a GC is tracking. For our purposes, primitives are anything with type <code>number</code>, <code>boolean</code>, <code>undefined</code>, and the value <code>null</code>.</p>
<p><strong>Stings are not primitives.</strong></p>
<p>So, given that knowledge, while <code>a={}</code>&apos;s value of <code>a</code> will be represented in the snapshot <code>b=1</code> will appear as an empty property called <code>b</code> only. There will be no knowledge of what is contained within <code>b</code> not even a type.</p>
<p>A Snapshot is a directed graph that may contain cycles; but Snapshots have a single defined entry point. The entry point is always defined by the VM and does not represent any particular user code. Cycles are caused by objects with circular references such as:</p>
<pre><code><code class="source-code prettyprint">x={};
x.self=x</code>
</code></pre><p>which causes a cycle by having a <a href="#Node">Node</a> for <code>x</code> having an <a href="#Edge">Edge</a> named <code>self</code> pointing to <code>x</code>.</p>
<h2 id="root">Root</h2>
<p>This is the defined entry point that determines what objects are going to survive GC. It is a Node just like any other in the graph with one slight exception. The root&apos;s Edges represents what the exact references VM is keeping alive, even if JS has no access to a Node, C++ may be keeping the Node alive! In that case it would show up in the Root still.</p>
<p>The root is important since, once a Node is no longer accessible from the root and the root&apos;s children, it can be garbage collected.</p>
<h1 id="node">Node</h1>
<p>This represents a specific instance of a <em>non-primitive</em> object that the GC is managing. It may represent user code or VM internals.</p>
<h2 id="node-type">node.type</h2>
<table>
<thead>
<tr>
<th>type</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>hidden</td>
<td>VM internals</td>
</tr>
<tr>
<td>array</td>
<td>An Array</td>
</tr>
<tr>
<td>string</td>
<td>A String that is completely represented by one Node</td>
</tr>
<tr>
<td>object</td>
<td>An Object</td>
</tr>
<tr>
<td>code</td>
<td>Machine code to perform an action</td>
</tr>
<tr>
<td>closure</td>
<td>An instance of a JS Function</td>
</tr>
<tr>
<td>regexp</td>
<td>A JS RegExp, includes state machine to perform the RegExp</td>
</tr>
<tr>
<td>number</td>
<td>A Number that is <em>not</em> a JS Number, used for internal fields</td>
</tr>
<tr>
<td>native</td>
<td>Represents C++ data</td>
</tr>
<tr>
<td>synthetic</td>
<td>VM internals, generally used to group Nodes for some purpose</td>
</tr>
<tr>
<td>concatenated string</td>
<td>A String that is formed by a chain of other Strings</td>
</tr>
<tr>
<td>sliced string</td>
<td>A String that is a slice of another String</td>
</tr>
</tbody>
</table>
<h2 id="node-name">node.name</h2>
<p>The meaning of a Node&apos;s name relates to it&apos;s type. For the most part names only describe what a Node represents (such as the name of a <code>closure</code>&apos;s function). However, <code>string</code> Nodes have names that represent their values.</p>
<h2 id="retainers">Retainers</h2>
<p>A retainer is any Node keeping another Node alive. This means that there is a single <a href="#Edge">Edge</a> from all the retainers of a Node to the retainer.</p>
<p>Given:</p>
<pre><code class="lang-prolog"><code class="source-code prettyprint">node(a)
node(b) contains node(a)</code>
</code></pre>
<p><code>node(b)</code> is a retainer of <code>node(a)</code>.</p>
<h2 id="dominator">Dominator</h2>
<p>A dominator is a <a href="#Node">Node</a> that <em>must</em> be traversed in order to reach another Node (the dominated Node). Any time a dominator is garbage collected, all dominated Nodes nodes are able to be garbage collected. This is not the only time a Node may become available for garbage collection.</p>
<h3 id="weak-reference-gotcha">Weak Reference Gotcha</h3>
<p>If a Node contains is being retained due to a weak reference this does not prevent it from being garbage collected. A dominator may not represent the Node that is preventing another Node from being collected.</p>
<p>Given:</p>
<pre><code class="lang-prolog"><code class="source-code prettyprint">node(a)
node(b) weakly contains node(a)
node(c) contains node(a)
node(d) contains node(b), node(c)</code>
</code></pre>
<p>The Dominator of <code>node(a)</code> is <code>node(d)</code>! But the only thing keeping <code>node(a)</code> alive is <code>node(c)</code>!</p>
<p>This is due to all paths to <code>node(a)</code> must go through <code>node(d)</code>. However, <code>node(c)</code> is the only Node that is not weakly containing <code>node(a)</code>. Since <code>node(b)</code> is weakly containing <code>node(a)</code> it is not preventing <code>node(a)</code> from being garbage collected. The only Node keeping <code>node(a)</code> from being garbage collected is <code>node(c)</code>.</p>
<h2 id="distance">Distance</h2>
<p>How far away from the <a href="#root">root</a> is this Node at minimum. This metric is only useful for finding very deeply nested objects.</p>
<h2 id="self-size">Self Size</h2>
<p>synonyms: <a href="#self-size">shallow size</a></p>
<p>This is the exact amount of memory that a Node occuppies without traversing any <a href="#Edge">Edges</a>. Since primitives are not shown in Snapshots, if the self size of a Node is growing it could mean multiple things.</p>
<ol>
<li>VM optimizations have occured so this Node takes more space</li>
<li>A property was added that is a primitive, this may or may not be represented in the edges called <code>&quot;properties&quot;</code> and <code>&quot;elements&quot;</code></li>
</ol>
<p>Both of these specific scenarios are detectable by <a href="#retained-size">retained size</a> since they are only accessible through this Node.</p>
<h2 id="retained-size">Retained Size</h2>
<p>synonyms: <a href="#retained-size">held memory</a></p>
<p>This is the amount of memory that is only accessible from the <a href="#root">root</a> by going through this Node.</p>
<h3 id="the-sharing-gotcha">The Sharing Gotcha</h3>
<p>Retained size is useful in seeing if a specific Node is causing growth. However, this can be misleading since a Node may be visible from multiple other Nodes.</p>
<p>Given:</p>
<pre><code class="lang-prolog"><code class="source-code prettyprint">node
parent(a) contains node
parent(b) contains node
grand_parent contains parents(a,b)</code>
</code></pre>
<p>If <code>node</code> grows in size, the retained size would only grow for <code>grand_parent</code>. This becomes complicated when a Node is shared between files. If <code>parent(a)</code> represents <code>a.js</code> and <code>parent(b)</code> represents <code>b.js</code> then grand_parent could be the <a href="#root">root</a> which would not grow the retained size of <code>a.js</code> or <code>b.js</code>! Use this with caution.</p>
<h2 id="closed-size">Closed Size</h2>
<p>Given a closure Node&apos;s child, this is the size of all Nodes visible from the current Node without entering another closure. This is the amount of memory that is reachable from this Node with respect to source code.</p>
<h3 id="the-global-gotcha">The Global Gotcha</h3>
<p>Since we are viewing <strong>all</strong> reachable nodes, we will reach the global context object. This size will be added to all closed sizes. This means that any closed size can be thought of as <code>all_globals + all_properties(obj)</code>.</p>
<h2 id="retained-size-vs-closed-size">Retained Size vs. Closed Size</h2>
<p>Retained size is great for finding out how much memory would be released when a Node is removed. However, it does not accurately represent how much memory is being held by a Node with knowledge of the source code. Closed size does represent the memory used by the source code, but does not accurately represent what would happen when a Node is removed.</p>
<h1 id="edge">Edge</h1>
<p>This represents the path between Nodes. Memory is actually held within the Node and edges are just a description of a property. They do not have memory associated with themselves. The simples example of an Edge is a property on an object:</p>
<pre><code><code class="source-code prettyprint">obj = { x : [] };</code>
</code></pre><p>The Node for <code>obj</code> has an edge named <code>x</code> that points to <code>[]</code>.</p>
<h2 id="edge-type">edge.type</h2>
<table>
<thead>
<tr>
<th>type</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>context</td>
<td>path to a variable</td>
</tr>
<tr>
<td>element</td>
<td>path to an array index</td>
</tr>
<tr>
<td>property</td>
<td>path to an object&apos;s property</td>
</tr>
<tr>
<td>internal</td>
<td>...</td>
</tr>
<tr>
<td>hidden</td>
<td>path that may be internal or defined in the JS spec, but not exposed to JS code</td>
</tr>
<tr>
<td>shortcut</td>
<td>VM taking a shortcut, same vein as internal. This is generally used for structures that are formed as a chain like a linked list of strings in the Snapshot representing a single JS string</td>
</tr>
<tr>
<td>weak</td>
<td>This is a reference that does not keep the children alive. If the only route to an object is through a weak edge, it can be garbage collected.</td>
</tr>
</tbody>
</table>
<h2 id="edge-name">edge.name</h2>
<p>The name of an edge is always descriptive. For <code>element</code> and <code>property</code> Edges it represents things visible via JS property access. For <code>context</code> it represents things visible via JS variables.</p>
<h1 id="security">Security</h1>
<p>Since Strings are visible from Snapshots you could accidentally leak information if Snapshots are sent over the network. Be particularly wary since these will be visible:</p>
<ul>
<li>Source code of Javascript files</li>
<li>Any string held by Javascript</li>
</ul>
<p>So, any configuration options, command line arguments, and any proprietary source code will be available to the consumer of a snapshot.</p>
<p>Some things are not visible from a Snapshot:</p>
<ul>
<li>Buffers</li>
<li>Typed Arrays</li>
<li>Primitives</li>
</ul>
<p>Consider placing data inside those types when you want to avoid it being in a snapshot.</p>
<h1 id="processing-considerations">Processing Considerations</h1>
<p>related: <a href="https://en.wikipedia.org/wiki/Tree_traversal">Tree Traversal</a></p>
<p>Since Snapshots have well defined entry points (the <a href="#root">root</a>), it is most useful not to treat them as a graph, but as a tree when aggregating data. Even though they are graphs we can still find all of the Nodes and Edges with a single tree traversal.</p>
<p>Almost all processing of Snapshots should be done with a depth first search in order to preserve memory. Most Snapshots are very wide (Nodes can have many edges), but not very deep (Nodes don&apos;t have many ancestors).</p>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
